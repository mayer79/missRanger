<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Censored Variables • missRanger</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Censored Variables">
<meta property="og:description" content="missRanger">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">missRanger</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/missRanger.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/multiple_imputation.html">Multiple Imputation</a>
    </li>
    <li>
      <a href="../articles/working_with_censoring.html">Censored Variables</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mayer79/missRanger/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Censored Variables</h1>
            
            <h4 data-toc-skip class="date">2023-05-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mayer79/missRanger/blob/HEAD/vignettes/working_with_censoring.Rmd" class="external-link"><code>vignettes/working_with_censoring.Rmd</code></a></small>
      <div class="hidden name"><code>working_with_censoring.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="how-to-deal-with-censored-variables">How to deal with censored variables?<a class="anchor" aria-label="anchor" href="#how-to-deal-with-censored-variables"></a>
</h2>
<p>There is no obvious way of how to deal with survival variables as
covariables in imputation models.</p>
<p>Options discussed in <span class="citation">(<a href="#ref-white" role="doc-biblioref">White and Royston 2009</a>)</span> include:</p>
<ul>
<li><p>Use both status variable <span class="math inline">\(s\)</span>
and (censored) time variable <span class="math inline">\(t\)</span></p></li>
<li><p><span class="math inline">\(s\)</span> and <span class="math inline">\(\log(t)\)</span></p></li>
<li><p><span class="math inline">\(\text{surv}(t)\)</span>, and,
optionally <span class="math inline">\(s\)</span></p></li>
</ul>
<p>By <span class="math inline">\(\text{surv}(t)\)</span>, we denote the
Nelson-Aalen survival estimate at each value of <span class="math inline">\(t\)</span>. The third option is the most elegant
one as it explicitly deals with censoring information. We provide some
additional details on it in the example.</p>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>For illustration, we use data from a randomized two-arm trial about
lung cancer. The aim is to estimate the treatment effect of “trt” with
reliable inference using Cox regression. Unfortunately, we have added
missing values in the covariables “age”, “karno”, and “diagtime”.</p>
<p>A reasonable way to estimate the covariable adjusted treatment effect
is the following:</p>
<ol style="list-style-type: decimal">
<li>Add Nelson-Aalen survival estimates “surv” to the dataset.</li>
<li>Use “surv” as well as the covariables to impute missing values in
the covariables multiple times.</li>
<li>Perform the intended Cox regression for each of the imputed data
sets.</li>
<li>Pool their results by Rubin’s rule <span class="citation">(<a href="#ref-rubin" role="doc-biblioref">Rubin 1987</a>)</span>, using
package {mice} <span class="citation">(<a href="#ref-buuren" role="doc-biblioref">Buuren and Groothuis-Oudshoorn
2011</a>)</span>.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mayer79/missRanger" class="external-link">missRanger</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice" class="external-link">mice</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">65</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">veteran</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#   trt celltype time status karno diagtime age prior</span></span>
<span><span class="co"># 1   1 squamous   72      1    60        7  69     0</span></span>
<span><span class="co"># 2   1 squamous  411      1    70        5  64    10</span></span>
<span><span class="co"># 3   1 squamous  228      1    60        3  38     0</span></span>
<span><span class="co"># 4   1 squamous  126      1    60        9  63    10</span></span>
<span><span class="co"># 5   1 squamous  118      1    70       11  65    10</span></span>
<span><span class="co"># 6   1 squamous   10      1    20        5  49     0</span></span>
<span></span>
<span><span class="co"># 1. Calculate Nelson-Aalen survival probabilities for each time point</span></span>
<span><span class="va">nelson_aalen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">veteran</span><span class="op">)</span>, </span>
<span>  times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">veteran</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="st">"surv"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">nelson_aalen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">nelson_aalen</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add it to the original data set</span></span>
<span><span class="va">veteran2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">veteran</span>, <span class="va">nelson_aalen</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add missing values to make things tricky</span></span>
<span><span class="va">veteran2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateNA.html">generateNA</a></span><span class="op">(</span><span class="va">veteran2</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">0.1</span>, karno <span class="op">=</span> <span class="fl">0.1</span>, diagtime <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Generate 20 complete data sets, representing "time" and "status" by "surv"</span></span>
<span><span class="va">filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span></span>
<span>  <span class="fl">20</span>, </span>
<span>  <span class="fu"><a href="../reference/missRanger.html">missRanger</a></span><span class="op">(</span></span>
<span>    <span class="va">veteran2</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">time</span> <span class="op">-</span> <span class="va">status</span>, </span>
<span>    verbose <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    pmm.k <span class="op">=</span> <span class="fl">3</span>, </span>
<span>    num.trees <span class="op">=</span> <span class="fl">25</span></span>
<span>  <span class="op">)</span>, </span>
<span>  simplify <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Run a Cox regression for each of the completed data sets</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">filled</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">surv</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Pool the results by mice</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pooled_fit</span> <span class="op">&lt;-</span> <span class="fu">pool</span><span class="op">(</span><span class="va">models</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#                term     estimate   std.error  statistic        df      p.value</span></span>
<span><span class="co"># 1               trt  0.238408881 0.213416156  1.1171079 108.30303 2.664203e-01</span></span>
<span><span class="co"># 2 celltypesmallcell  0.801088770 0.286383107  2.7972626 112.17712 6.066665e-03</span></span>
<span><span class="co"># 3     celltypeadeno  1.134351839 0.308977998  3.6713030 110.65791 3.731780e-04</span></span>
<span><span class="co"># 4     celltypelarge  0.327092592 0.291069423  1.1237614 109.29555 2.635765e-01</span></span>
<span><span class="co"># 5             karno -0.031250557 0.005786704 -5.4004073  99.60711 4.529695e-07</span></span>
<span><span class="co"># 6          diagtime  0.002889092 0.009020319  0.3202872 106.17585 7.493801e-01</span></span>
<span><span class="co"># 7               age -0.007620985 0.009632902 -0.7911411  97.27459 4.307864e-01</span></span>
<span><span class="co"># 8             prior  0.003954604 0.023537476  0.1680131 111.98360 8.668760e-01</span></span>
<span></span>
<span><span class="co"># Compare with the results on the original data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">veteran</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span>
<span></span>
<span><span class="co">#                            coef exp(coef)    se(coef)            z     Pr(&gt;|z|)</span></span>
<span><span class="co"># trt                2.946028e-01 1.3425930 0.207549604  1.419433313 1.557727e-01</span></span>
<span><span class="co"># celltypesmallcell  8.615605e-01 2.3668512 0.275284474  3.129709606 1.749792e-03</span></span>
<span><span class="co"># celltypeadeno      1.196066e+00 3.3070825 0.300916994  3.974738536 7.045662e-05</span></span>
<span><span class="co"># celltypelarge      4.012917e-01 1.4937529 0.282688638  1.419553530 1.557377e-01</span></span>
<span><span class="co"># karno             -3.281533e-02 0.9677173 0.005507757 -5.958020093 2.553121e-09</span></span>
<span><span class="co"># diagtime           8.132051e-05 1.0000813 0.009136062  0.008901046 9.928981e-01</span></span>
<span><span class="co"># age               -8.706475e-03 0.9913313 0.009300299 -0.936149992 3.491960e-01</span></span>
<span><span class="co"># prior              7.159360e-03 1.0071850 0.023230538  0.308187441 7.579397e-01</span></span></code></pre></div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-buuren" class="csl-entry">
Buuren, Stef van, and Karin Groothuis-Oudshoorn. 2011. <span>“Mice:
Multivariate Imputation by Chained Equations in r.”</span> <em>Journal
of Statistical Software, Articles</em> 45 (3): 1–67. <a href="https://doi.org/10.18637/jss.v045.i03" class="external-link">https://doi.org/10.18637/jss.v045.i03</a>.
</div>
<div id="ref-rubin" class="csl-entry">
Rubin, D. B. 1987. <em>Multiple Imputation for Nonresponse in
Surveys</em>. Wiley Series in Probability and Statistics. Wiley.
</div>
<div id="ref-white" class="csl-entry">
White, Ian R., and Patrick Royston. 2009. <span>“Imputing Missing
Covariate Values for the Cox Model.”</span> <em>Statistics in
Medicine</em> 28 (15): 1982–98. <a href="https://doi.org/10.1002/sim.3618" class="external-link">https://doi.org/10.1002/sim.3618</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Mayer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
