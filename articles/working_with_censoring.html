<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Censored Variables • missRanger</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Censored Variables">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">missRanger</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/missRanger.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/multiple_imputation.html">Multiple Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/working_with_censoring.html">Censored Variables</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mayer79/missRanger/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Censored Variables</h1>
            
            <h4 data-toc-skip class="date">2024-07-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mayer79/missRanger/blob/2.5.0/vignettes/working_with_censoring.Rmd" class="external-link"><code>vignettes/working_with_censoring.Rmd</code></a></small>
      <div class="d-none name"><code>working_with_censoring.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="how-to-deal-with-censored-variables">How to deal with censored variables?<a class="anchor" aria-label="anchor" href="#how-to-deal-with-censored-variables"></a>
</h2>
<p>There is no obvious way of how to deal with survival variables as
covariables in imputation models.</p>
<p>Options discussed in <span class="citation">(<a href="#ref-white">White and Royston 2009</a>)</span> include:</p>
<ul>
<li><p>Use both status variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
and (censored) time variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log(t)</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">surv</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{surv}(t)</annotation></semantics></math>,
and, optionally
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math></p></li>
</ul>
<p>By
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">surv</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{surv}(t)</annotation></semantics></math>,
we denote the Nelson-Aalen survival estimate at each value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
The third option is the most elegant one as it explicitly deals with
censoring information. We provide some additional details on it in the
example.</p>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>For illustration, we use data from a randomized two-arm trial about
lung cancer. The aim is to estimate the treatment effect of “trt” with
reliable inference using Cox regression. Unfortunately, we have added
missing values in the covariables “age”, “karno”, and “diagtime”.</p>
<p>A reasonable way to estimate the covariable adjusted treatment effect
is the following:</p>
<ol style="list-style-type: decimal">
<li>Add Nelson-Aalen survival estimates “surv” to the dataset.</li>
<li>Use “surv” as well as the covariables to impute missing values in
the covariables multiple times.</li>
<li>Perform the intended Cox regression for each of the imputed data
sets.</li>
<li>Pool their results by Rubin’s rule <span class="citation">(<a href="#ref-rubin">Rubin 1987</a>)</span>, using package {mice} <span class="citation">(<a href="#ref-buuren">Buuren and Groothuis-Oudshoorn
2011</a>)</span>.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mayer79/missRanger" class="external-link">missRanger</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice" class="external-link">mice</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">65</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">veteran</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#   trt celltype time status karno diagtime age prior</span></span>
<span><span class="co"># 1   1 squamous   72      1    60        7  69     0</span></span>
<span><span class="co"># 2   1 squamous  411      1    70        5  64    10</span></span>
<span><span class="co"># 3   1 squamous  228      1    60        3  38     0</span></span>
<span><span class="co"># 4   1 squamous  126      1    60        9  63    10</span></span>
<span><span class="co"># 5   1 squamous  118      1    70       11  65    10</span></span>
<span><span class="co"># 6   1 squamous   10      1    20        5  49     0</span></span>
<span></span>
<span><span class="co"># 1. Calculate Nelson-Aalen survival probabilities for each time point</span></span>
<span><span class="va">nelson_aalen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">veteran</span><span class="op">)</span>, </span>
<span>  times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">veteran</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="st">"surv"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">nelson_aalen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">nelson_aalen</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add it to the original data set</span></span>
<span><span class="va">veteran2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">veteran</span>, <span class="va">nelson_aalen</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add missing values to make things tricky</span></span>
<span><span class="va">veteran2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateNA.html">generateNA</a></span><span class="op">(</span><span class="va">veteran2</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">0.1</span>, karno <span class="op">=</span> <span class="fl">0.1</span>, diagtime <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Generate 20 complete data sets, representing "time" and "status" by "surv"</span></span>
<span><span class="va">filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span></span>
<span>  <span class="fl">20</span>, </span>
<span>  <span class="fu"><a href="../reference/missRanger.html">missRanger</a></span><span class="op">(</span></span>
<span>    <span class="va">veteran2</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">time</span> <span class="op">-</span> <span class="va">status</span>, </span>
<span>    verbose <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    pmm.k <span class="op">=</span> <span class="fl">3</span>, </span>
<span>    num.trees <span class="op">=</span> <span class="fl">25</span></span>
<span>  <span class="op">)</span>, </span>
<span>  simplify <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Run a Cox regression for each of the completed data sets</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">filled</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">surv</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Pool the results by mice</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pooled_fit</span> <span class="op">&lt;-</span> <span class="fu">pool</span><span class="op">(</span><span class="va">models</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#                term     estimate   std.error  statistic        df      p.value</span></span>
<span><span class="co"># 1               trt  0.245855250 0.212810467  1.1552780 108.72929 2.505091e-01</span></span>
<span><span class="co"># 2 celltypesmallcell  0.805233656 0.284424937  2.8310937 114.17088 5.483657e-03</span></span>
<span><span class="co"># 3     celltypeadeno  1.110172771 0.307570269  3.6094931 111.91588 4.603422e-04</span></span>
<span><span class="co"># 4     celltypelarge  0.328227283 0.291163500  1.1272954 109.30510 2.620862e-01</span></span>
<span><span class="co"># 5             karno -0.031838682 0.005663349 -5.6218824 112.60325 1.390333e-07</span></span>
<span><span class="co"># 6          diagtime  0.002775351 0.009382270  0.2958081  86.61582 7.680847e-01</span></span>
<span><span class="co"># 7               age -0.007843577 0.009293988 -0.8439410 107.86917 4.005701e-01</span></span>
<span><span class="co"># 8             prior  0.003165245 0.023501821  0.1346809 111.84783 8.931063e-01</span></span>
<span></span>
<span><span class="co"># Compare with the results on the original data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">veteran</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span>
<span></span>
<span><span class="co">#                            coef exp(coef)    se(coef)            z     Pr(&gt;|z|)</span></span>
<span><span class="co"># trt                2.946028e-01 1.3425930 0.207549604  1.419433313 1.557727e-01</span></span>
<span><span class="co"># celltypesmallcell  8.615605e-01 2.3668512 0.275284474  3.129709606 1.749792e-03</span></span>
<span><span class="co"># celltypeadeno      1.196066e+00 3.3070825 0.300916994  3.974738536 7.045662e-05</span></span>
<span><span class="co"># celltypelarge      4.012917e-01 1.4937529 0.282688638  1.419553530 1.557377e-01</span></span>
<span><span class="co"># karno             -3.281533e-02 0.9677173 0.005507757 -5.958020093 2.553121e-09</span></span>
<span><span class="co"># diagtime           8.132051e-05 1.0000813 0.009136062  0.008901046 9.928981e-01</span></span>
<span><span class="co"># age               -8.706475e-03 0.9913313 0.009300299 -0.936149992 3.491960e-01</span></span>
<span><span class="co"># prior              7.159360e-03 1.0071850 0.023230538  0.308187441 7.579397e-01</span></span></code></pre></div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-buuren" class="csl-entry">
Buuren, Stef van, and Karin Groothuis-Oudshoorn. 2011. <span>“Mice:
Multivariate Imputation by Chained Equations in r.”</span> <em>Journal
of Statistical Software, Articles</em> 45 (3): 1–67. <a href="https://doi.org/10.18637/jss.v045.i03" class="external-link">https://doi.org/10.18637/jss.v045.i03</a>.
</div>
<div id="ref-rubin" class="csl-entry">
Rubin, D. B. 1987. <em>Multiple Imputation for Nonresponse in
Surveys</em>. Wiley Series in Probability and Statistics. Wiley.
</div>
<div id="ref-white" class="csl-entry">
White, Ian R., and Patrick Royston. 2009. <span>“Imputing Missing
Covariate Values for the Cox Model.”</span> <em>Statistics in
Medicine</em> 28 (15): 1982–98. <a href="https://doi.org/10.1002/sim.3618" class="external-link">https://doi.org/10.1002/sim.3618</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Mayer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
