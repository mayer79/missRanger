<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Censored Variables • missRanger</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Censored Variables">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">missRanger</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/missRanger.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/multiple_imputation.html">Multiple Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/working_with_censoring.html">Censored Variables</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mayer79/missRanger/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Censored Variables</h1>
            
            <h4 data-toc-skip class="date">2024-07-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mayer79/missRanger/blob/main/vignettes/working_with_censoring.Rmd" class="external-link"><code>vignettes/working_with_censoring.Rmd</code></a></small>
      <div class="d-none name"><code>working_with_censoring.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="how-to-deal-with-censored-variables">How to deal with censored variables?<a class="anchor" aria-label="anchor" href="#how-to-deal-with-censored-variables"></a>
</h2>
<p>There is no obvious way of how to deal with survival variables as
covariates in imputation models.</p>
<p>Options discussed in <span class="citation">(<a href="#ref-white">White and Royston 2009</a>)</span> include:</p>
<ul>
<li><p>Use both status variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
and (censored) time variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log(t)</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">surv</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{surv}(t)</annotation></semantics></math>,
and, optionally
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math></p></li>
</ul>
<p>By
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">surv</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{surv}(t)</annotation></semantics></math>,
we denote the Nelson-Aalen survival estimate at each value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
The third option seems attractive as it explicitly deals with censoring
information. We provide some additional details on it in the
example.</p>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>For illustration, we use data from a randomized two-arm trial about
lung cancer. The aim is to estimate the treatment effect of “trt” with
reliable inference using Cox regression. We add missing values in the
covariates “age”, “karno”, and “diagtime”.</p>
<p>Let’s estimate the covariate adjusted treatment effect using the
following steps:</p>
<ol style="list-style-type: decimal">
<li>Add Nelson-Aalen survival estimates “surv” to the dataset.</li>
<li>Use “surv” as well as the covariates to impute missing values in the
covariates multiple times.</li>
<li>Perform the intended Cox regression for each of the imputed data
sets.</li>
<li>Pool their results by Rubin’s rule <span class="citation">(<a href="#ref-rubin">Rubin 1987</a>)</span>, using package {mice} <span class="citation">(<a href="#ref-buuren">Buuren and Groothuis-Oudshoorn
2011</a>)</span>.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(missRanger)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">65</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">head</span>(veteran)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#   trt celltype time status karno diagtime age prior</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># 1   1 squamous   72      1    60        7  69     0</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co"># 2   1 squamous  411      1    70        5  64    10</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># 3   1 squamous  228      1    60        3  38     0</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># 4   1 squamous  126      1    60        9  63    10</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co"># 5   1 squamous  118      1    70       11  65    10</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co"># 6   1 squamous   10      1    20        5  49     0</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co"># 1. Calculate Nelson-Aalen survival probabilities for each time point</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>nelson_aalen <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> veteran) <span class="sc">|&gt;</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">times =</span> <span class="fu">unique</span>(veteran<span class="sc">$</span>time))</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>nelson_aalen <span class="ot">&lt;-</span> nelson_aalen[<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"surv"</span>)]</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co"># Add it to the original data set</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>veteran2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(veteran, nelson_aalen, <span class="at">all.x =</span> <span class="cn">TRUE</span>, <span class="at">by =</span> <span class="st">"time"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="co"># Add missing values to make things tricky</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>veteran2 <span class="ot">&lt;-</span> <span class="fu">generateNA</span>(veteran2, <span class="at">p =</span> <span class="fu">c</span>(<span class="at">age =</span> <span class="fl">0.1</span>, <span class="at">karno =</span> <span class="fl">0.1</span>, <span class="at">diagtime =</span> <span class="fl">0.1</span>))</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co"># 2. Generate 20 complete data sets, representing "time" and "status" by "surv"</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>filled <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>  <span class="dv">20</span>, </span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>  <span class="fu">missRanger</span>(</span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>    veteran2, . <span class="sc">~</span> . <span class="sc">-</span> time <span class="sc">-</span> status, </span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="dv">0</span>, </span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>    <span class="at">pmm.k =</span> <span class="dv">10</span>, </span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>    <span class="at">num.trees =</span> <span class="dv">25</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>  ), </span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>  <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>)</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a><span class="co"># 3. Run a Cox regression for each of the completed data sets</span></span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">lapply</span>(filled, <span class="cf">function</span>(x) <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> . <span class="sc">-</span> surv, x))</span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a><span class="co"># 4. Pool the results by mice</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a><span class="fu">summary</span>(pooled_fit <span class="ot">&lt;-</span> <span class="fu">pool</span>(models))</span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a>               term     estimate   std.error  statistic        df      p.value</span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a><span class="dv">1</span>               trt  <span class="fl">0.253538955</span> <span class="fl">0.212912636</span>  <span class="fl">1.1908122</span> <span class="fl">108.60558</span> <span class="fl">2.363235e-01</span></span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a><span class="dv">2</span> celltypesmallcell  <span class="fl">0.815455716</span> <span class="fl">0.285715626</span>  <span class="fl">2.8540816</span> <span class="fl">113.48112</span> <span class="fl">5.132019e-03</span></span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a><span class="dv">3</span>     celltypeadeno  <span class="fl">1.110530627</span> <span class="fl">0.311566058</span>  <span class="fl">3.5643505</span> <span class="fl">108.55506</span> <span class="fl">5.436043e-04</span></span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a><span class="dv">4</span>     celltypelarge  <span class="fl">0.346762041</span> <span class="fl">0.288497586</span>  <span class="fl">1.2019582</span> <span class="fl">113.27005</span> <span class="fl">2.318866e-01</span></span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a><span class="dv">5</span>             karno <span class="sc">-</span><span class="fl">0.030754195</span> <span class="fl">0.005758037</span> <span class="sc">-</span><span class="fl">5.3410901</span>  <span class="fl">99.68585</span> <span class="fl">5.837902e-07</span></span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a><span class="dv">6</span>          diagtime  <span class="fl">0.001835002</span> <span class="fl">0.009233708</span>  <span class="fl">0.1987286</span> <span class="fl">107.07024</span> <span class="fl">8.428519e-01</span></span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a><span class="dv">7</span>               age <span class="sc">-</span><span class="fl">0.006032505</span> <span class="fl">0.009447786</span> <span class="sc">-</span><span class="fl">0.6385099</span> <span class="fl">101.88961</span> <span class="fl">5.245745e-01</span></span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a><span class="dv">8</span>             prior  <span class="fl">0.002983767</span> <span class="fl">0.023275501</span>  <span class="fl">0.1281935</span> <span class="fl">115.27919</span> <span class="fl">8.982192e-01</span></span>
<span id="cb1-55"><a href="#cb1-55" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" tabindex="-1"></a><span class="co"># Compare with the results on the original data</span></span>
<span id="cb1-57"><a href="#cb1-57" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> ., veteran))<span class="sc">$</span>coefficients</span>
<span id="cb1-58"><a href="#cb1-58" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" tabindex="-1"></a>                           coef <span class="fu">exp</span>(coef)    <span class="fu">se</span>(coef)            z     <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>z<span class="sc">|</span>)</span>
<span id="cb1-60"><a href="#cb1-60" tabindex="-1"></a>trt                <span class="fl">2.946028e-01</span> <span class="fl">1.3425930</span> <span class="fl">0.207549604</span>  <span class="fl">1.419433313</span> <span class="fl">1.557727e-01</span></span>
<span id="cb1-61"><a href="#cb1-61" tabindex="-1"></a>celltypesmallcell  <span class="fl">8.615605e-01</span> <span class="fl">2.3668512</span> <span class="fl">0.275284474</span>  <span class="fl">3.129709606</span> <span class="fl">1.749792e-03</span></span>
<span id="cb1-62"><a href="#cb1-62" tabindex="-1"></a>celltypeadeno      <span class="fl">1.196066e+00</span> <span class="fl">3.3070825</span> <span class="fl">0.300916994</span>  <span class="fl">3.974738536</span> <span class="fl">7.045662e-05</span></span>
<span id="cb1-63"><a href="#cb1-63" tabindex="-1"></a>celltypelarge      <span class="fl">4.012917e-01</span> <span class="fl">1.4937529</span> <span class="fl">0.282688638</span>  <span class="fl">1.419553530</span> <span class="fl">1.557377e-01</span></span>
<span id="cb1-64"><a href="#cb1-64" tabindex="-1"></a>karno             <span class="sc">-</span><span class="fl">3.281533e-02</span> <span class="fl">0.9677173</span> <span class="fl">0.005507757</span> <span class="sc">-</span><span class="fl">5.958020093</span> <span class="fl">2.553121e-09</span></span>
<span id="cb1-65"><a href="#cb1-65" tabindex="-1"></a>diagtime           <span class="fl">8.132051e-05</span> <span class="fl">1.0000813</span> <span class="fl">0.009136062</span>  <span class="fl">0.008901046</span> <span class="fl">9.928981e-01</span></span>
<span id="cb1-66"><a href="#cb1-66" tabindex="-1"></a>age               <span class="sc">-</span><span class="fl">8.706475e-03</span> <span class="fl">0.9913313</span> <span class="fl">0.009300299</span> <span class="sc">-</span><span class="fl">0.936149992</span> <span class="fl">3.491960e-01</span></span>
<span id="cb1-67"><a href="#cb1-67" tabindex="-1"></a>prior              <span class="fl">7.159360e-03</span> <span class="fl">1.0071850</span> <span class="fl">0.023230538</span>  <span class="fl">0.308187441</span> <span class="fl">7.579397e-01</span></span></code></pre></div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-buuren" class="csl-entry">
Buuren, Stef van, and Karin Groothuis-Oudshoorn. 2011. <span>“Mice:
Multivariate Imputation by Chained Equations in r.”</span> <em>Journal
of Statistical Software, Articles</em> 45 (3): 1–67. <a href="https://doi.org/10.18637/jss.v045.i03" class="external-link">https://doi.org/10.18637/jss.v045.i03</a>.
</div>
<div id="ref-rubin" class="csl-entry">
Rubin, D. B. 1987. <em>Multiple Imputation for Nonresponse in
Surveys</em>. Wiley Series in Probability and Statistics. Wiley.
</div>
<div id="ref-white" class="csl-entry">
White, Ian R., and Patrick Royston. 2009. <span>“Imputing Missing
Covariate Values for the Cox Model.”</span> <em>Statistics in
Medicine</em> 28 (15): 1982–98. <a href="https://doi.org/10.1002/sim.3618" class="external-link">https://doi.org/10.1002/sim.3618</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Mayer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
